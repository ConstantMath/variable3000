function form_layout(a){var e=a.val();a.parent().parent().children(".form-group.opt").each(function(){$(this).hasClass(e)?$(this).show():$(this).hide()})}function updateModalInfos(a){var e=$("#panel-"+a.column_name+" .ghost"),t=e.clone();if(e.before(t),t.removeClass("ghost"),t.attr("media-id",a.media_id),t.attr("id","media-"+a.media_id),t.find("a").attr("data-article-id",a.article_id),t.find("a").attr("data-media-id",a.media_id),t.find("a").attr("data-media-alt",a.media_alt),t.find("a").attr("data-media-description",a.media_description),t.find("a").attr("data-size",a.size),t.find("a").attr("data-media-background-color",a.media_background_color),t.find("a").attr("data-media-background-image",a.media_background_image),t.find("a").attr("data-delete-link","/admin/articles/"+a.media_id+"/deletemedia"),"jpg"==a.media_type||"png"==a.media_type||"gif"==a.media_type||"svg"==a.media_type||"jpeg"==a.media_type){var i='<i class="fa fa-image"></i>';t.find("a").attr("data-media-url","/imagecache/large/"+a.media_name)}else if("pdf"==a.media_type){var i='<i class="fa fa-file-pdf-o"></i>';t.find("a").attr("data-media-url","")}else{var i='<i class="fa fa-file"></i>';t.find("a").attr("data-media-url","")}t.find("i.fa").remove(),t.find("span").before(i),t.find("span").html(a.media_alt)}$(document).ready(function(){$(".select-admin-layout").length&&(form_layout($(".select-admin-layout")),$(".select-admin-layout").change(function(){form_layout($(this))}))}),$(document).ready(function(){function a(a,e,t,i){0==a.success||($("#main-form #"+a.column_name).val(JSON.stringify(a.media_id)),$("#panel-"+a.column_name+" li:not(.ghost)").detach(),updateModalInfos(a))}function e(a,e,t,i){if(0==a.success);else{if("null"==a.article_id){var d=[],n=$("#input-mediagallery").val();n&&(d=d.concat(n)),d.push(a.media_id),$("#main-form #input-mediagallery").val(d)}updateModalInfos(a)}}$(".media-add").click(function(){var a=$(this).prev();return a.attr("type","file"),a.trigger("click"),!1});var t={success:a,dataType:"json"};$("body").delegate(".input-single-media-upload","change",function(){$(".single-media-form").ajaxForm(t).submit()});var i={success:e,dataType:"json"};$("body").delegate("#gallery-image","change",function(){$("#article-gallery-upload").ajaxForm(i).submit()}),$("#mediagallery").length&&Sortable.create(mediagallery,{onUpdate:function(a){var e=a.item.getAttribute("url"),t=a.item.getAttribute("media-id"),i=a.newIndex;e&&t&&jQuery.ajax({url:e,data:{mediaId:t,newOrder:i},type:"POST",success:function(a){"success"==a.status&&$('<span class="message pull-right">Updated !</span>').appendTo(".panel-mediagallery .panel-heading").fadeOut(3e3)}})}})}),$("#modal-media-edit").on("show.bs.modal",function(a){var e=$(a.relatedTarget),t=(e.data("article_id"),e.data("delete-link")),i=e.data("column-name"),d=e.data("media-id"),n=e.data("media-alt"),l=e.data("media-url"),r=e.data("media-description"),o=$(this);o.find(".media-delete").attr("href",t),o.find(".media-delete").attr("column_name",i),o.find(".media-delete").attr("media_id",d),o.find(".single-m-delete").attr("media_id",d),o.find("#input_media_id").val(d),o.find("#input_media_alt").val(n),o.find("#input_media_description").val(r),o.find("#pic").attr("src",l),$("#modalButton").off("click")}),$("#modal-media-edit-custom").on("show.bs.modal",function(a){var e=$(a.relatedTarget),t=(e.data("article_id"),e.data("delete-link")),i=e.data("column-name"),d=e.data("media-id"),n=e.data("media-alt"),l=e.data("media-url"),r=e.data("media-size"),o=e.data("media-background-color"),m=e.data("media-background-image"),c=$(this);c.find("#pic").attr("src",l),c.find(".media-delete").attr("href",t),c.find(".media-delete").attr("column_name",i),c.find(".media-delete").attr("media_id",d),c.find(".single-m-delete").attr("media_id",d),c.find("#input_media_id").val(d),c.find("#input_media_alt").val(n),c.find("#size").val(r),c.find("#background-color").val(o),m.endsWith("small/")?c.find("#pic-background-image").hide():c.find("#pic-background-image").attr("src",m),$("#modalButton").off("click")}),$(document).ready(function(){function a(a,e,t,i){if("success"==a.status){var d=$("li#media-"+a.media_id),n=d.clone();d.hide();n.find("> a");n.find("span").text(a.media_alt),n.find("a").attr("data-media-alt",a.media_alt),n.find("a").attr("data-media-description",a.media_description),n.find("a").attr("data-media-size",a.media_size),n.find("a").attr("data-media-background-image","/imagecache/small/"+a.media_background_image),n.find("a").attr("data-media-background-color",a.media_background_color),d.before(n),d.remove()}}var e={success:a,dataType:"json"};$(".media-edit-save").click(function(a){a.preventDefault(),$(this).closest("form").ajaxForm(e).submit()}),$(".modal").on("click",".media-delete",function(a){a.preventDefault();var e=$(this).attr("href"),t=$(this).attr("column_name"),i=$(this).attr("media_id");e&&i&&jQuery.ajax({url:e,data:{column_name:t,media_id:i},type:"POST",success:function(a){if("success"==a.status){if("mediagallery"==a.column_name)for(var e=$("#main-form #input-mediagallery").val(),i=e.split(","),d=i.length-1;d>=0;d--)i[d]===a.media_id&&(i.splice(d,1),$("#main-form #input-mediagallery").val(i));else $("#main-form #"+t).val(null);$("#panel-"+a.column_name+" .list-group #media-"+a.media_id).detach()}}})})}),$(document).ready(function(){if($.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$(".datepicker").length&&$(".datepicker").datetimepicker({locale:"en",format:"DD/MM/YYYY"}),$(".md-editor").length&&$(".md-editor").each(function(){var a=new SimpleMDE({element:this,toolbar:["heading-3","bold","italic","|","quote","ordered-list","unordered-list","link","|","preview","side-by-side","fullscreen","|",{name:"help",action:function(a){window.open("http://variable.club/_docs/markdown-guide.html","_blank")},className:"fa fa-question-circle",title:"Help"}]});inlineAttachment.editors.codemirror4.attach(a.codemirror,{uploadUrl:"/admin/fileupload",allowedTypes:["image/jpeg","image/png","image/jpg","image/gif","application/pdf"],extraHeaders:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},onFileUploadResponse:function(a){var e=JSON.parse(a.responseText),t=e[this.settings.jsonFieldName];if(e&&t){var i;"pdf"==e.extension?urlText="["+e.name+"]({filename})":urlText=this.settings.urlText,i="function"==typeof urlText?urlText.call(this,t,e):urlText.replace(this.filenameTag,t);var d=this.editor.getValue().replace(this.lastValue,i);this.editor.setValue(d),this.settings.onFileUploaded.call(this,t)}return!1}}),$('a[data-toggle="tab"]').on("shown.bs.tab",function(e){setTimeout(function(){a.codemirror.refresh()},10)})}),$(".select2").select2({placeholder:"Select or add something",tags:!0,tokenSeparators:[","],allowClear:!0}),$(".sortable").length){var a=document.getElementById("index");Sortable.create(a,{onUpdate:function(a){var e=a.item.getAttribute("url"),t=a.item.getAttribute("parent_id"),i=a.newIndex;e&&t&&jQuery.ajax({url:e,data:{parent_id:t,new_order:i},type:"POST",success:function(a){a.status}})}})}$(".tip.created_at").on("click",function(){$(this).addClass("show")}),$(".color-picker").colorpicker({})});